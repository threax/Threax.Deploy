{
  "stack": "test",
  "secrets": {
    "appsettings-secrets-json": {
      "AppConfig": {
        "ConnectionString": "$(AppConfig.ConnectionString)",
        "StaticSitePath": "${INTERNAL_DATA_COMPILED}"
      },
      "JwtAuth": {
        "ClientSecret": "$(JwtAuth.ClientSecret)"
      },
      "SharedClientCredentials": {
        "ClientSecret": "$(SharedClientCredentials.ClientSecret)"
      }
    },
    "other-file-secrets": "external"
  },
  "volumes": {
    "olsdocs-source": { "external": true }
  },
  "services": {
    "app": {
      "image": "spcols.azure.whatever/image-linux-x64",
      "build": {
        "context": ".",
        "dockerfile": "Dockerfile"
      },
      "secrets": [
        {
          "source": "appsettings-secrets-json",
          "target": "~:/app/appsettings.secrets.json"
        },
        {
          "source": "app-ssl",
          "target": "~:/app/AppCert.pfx"
        }
      ],
      "deploy": {
        "placement": {
          "constraints": [ "otherconstraint == constraint" ]
        }
      },
      "volumes": [
        {
          "type": "volume",
          "source": "olsdocs-source",
          "target": "~:/data/source"
        }
      ],
      "environment": [
        "ASPNETCORE_URLS=http://*:5000",
        "ASPNETCORE_ENVIRONMENT=${ENV}",
        "SECURE_SITE_APPNAME=OlsDocs"
      ],
      "labels": [
        "threax.nginx.host=${URL}",
        "threax.nginx.port=5000",
        "threax.nginx.alias=${ALIAS}",
        "threax.nginx.cert={{Threax.StackDeploy.CreateCert()}}"
      ]
    }
  }
}
